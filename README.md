# SMSGateway â€“ A flat-file based SMS gateway PHP class using an open source Android app

## Features
- SMS gateway using the open source Android application SMS Gateway (https://github.com/medic/cht-gateway)

## License
This software is distributed under the [ LGPL-3.0-only](https://www.gnu.org/licenses/lgpl-3.0.html) license. Please read [LICENSE](https://github.com/multiOTP/SMSGateway/blob/master/COPYING.LESSER) for information on the software availability and distribution.

## Installation & loading
SMSGateway will be available on [Packagist](https://packagist.org/packages/multiOTP/SMSGateway) (using semantic versioning), and installation via [Composer](https://getcomposer.org) is the recommended way to install SMSGateway. Just add this line to your `composer.json` file:

```json
"multiotp/smsgateway": "^1.0"
```

or run

```sh
composer require multiotp/smsgateway
```

Note that the `vendor` folder and the `vendor/autoload.php` script are generated by Composer; they are not part of SMSGateway.

Alternatively, if you're not using Composer, you
can [download SMSGateway as a zip file](https://github.com/multiOTP/SMSGateway/archive/master.zip), then copy the contents of the SMSGateway folder into one of the `include_path` directories specified in your PHP configuration and load each class file manually:

```php
<?php
use multiOTP\SMSGateway\SMSGateway;

require 'path/to/SMSGateway/src/SMSGateway.php';
```

## Two simple examples

```php
<?php
//Import SMSGateway classes into the global namespace
//These must be at the top of your script, not inside a function
use multiOTP\SMSGateway\SMSGateway;

//Load Composer's autoloader
require 'vendor/autoload.php';

//Create an instance
$smsgateway = new SMSGateway();

// Set the data folder
$smsgateway->setDataPath(__DIR__ . DIRECTORY_SEPARATOR . 'data' . DIRECTORY_SEPARATOR);

$hash_secret = "secret";
$device_id   = "demo";
$to = "+1234567890";
$message = "Demo message";
$device_h = $smsgateway->calculateHash($hash_secret, $device_id);

$message_id = $smsgateway->sendMessage($device_id, $to, $message);

echo "Full URL for Android app URL: https://......./?id=$device_id&h=$device_h";
```

```php
<?php
//Import SMSGateway classes into the global namespace
//These must be at the top of your script, not inside a function
use multiOTP\SMSGateway\SMSGateway;

//Load Composer's autoloader
require 'vendor/autoload.php';

function new_message_handling($array) {
  // Handling $array of new received messages
  // [["id"           => "message_id",
  //   "from"         => "from_phone",
  //   "sms_sent"     => "sms_sent_timestamp",
  //   "sms_received" => "sms_received_timestamp",
  //   "content"      => "message_content",
  //   "status"       => "message-status"
  //  ],
  //  [...]
  // ]
}

function update_handling($array) {
  // Handling $array of status updates for sent messages
  // [["device_id"    => "device_id",
  //   "message_id"   => "message_id",
  //   "status"       => "message-status"
  //  ],
  //  [...]
  // ]
}

function timeout_handling($array) {
  // Handling $array of devices not seen during the last "DeviceTimeout" seconds
  // [["device_id"   => "device_id",
  //   "last_update" => "device_last_update"
  //  ],
  //  [...]
  // ]
}

//Create an instance
$smsgateway = new SMSGateway();

// Set the data folder
$smsgateway->setDataPath(__DIR__ . DIRECTORY_SEPARATOR . 'data' . DIRECTORY_SEPARATOR);

// Launch the API server with callback functions definition
$smsgateway->apiServer("secret", "new_message_handling", "update_handling", "timeout_handling");
```

That's it. You should now be ready to use SMSGateway!